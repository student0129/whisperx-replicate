build:
  gpu: true
  python_version: "3.9"
  system_packages:
    - "ffmpeg"
    - "libsndfile1"
    - "git"
  python_packages:
    - "torch==2.1.2"
    - "torchaudio==2.1.2"
    - "torchvision==0.16.2"
    - "numpy<2.0"
    - "pydub"
    # --- Start of Changes ---
    - "whisperx==3.1.1"              # Pin whisperx to a known stable version
    - "faster-whisper==0.9.0"         # Pin its backend for compatibility
    - "ctranslate2==3.20.1"         # Pin the model loader for stability
    # --- End of Changes ---
  run:
    - "pip install pyannote.audio==3.1.1"  # Your custom install step is unchanged
predict: "predict.py:Predictor"
